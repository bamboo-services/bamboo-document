---
title: 核心说明
description: Bamboo Base 整体架构设计与模块说明
icon: Layers
---

import { TypeTable } from '@/components/type-table';

# 核心架构

## 项目概述

**模块名称**: `github.com/bamboo-services/bamboo-base-go`

**Go 版本**: 1.24+

**项目定位**: Go 语言基础框架库，为 Bamboo 服务提供核心功能支持，包括日志、错误处理、雪花算法 ID 生成、验证器、中间件等基础设施。

## 包结构说明

```
github.com/bamboo-services/bamboo-base-go/
├── base_response.go        # 根包：统一响应结构体 (xBase)
│
├── context/                # 上下文常量 (xConsts)
├── env/                    # 环境变量管理 (xEnv)
├── error/                  # 错误码和错误处理 (xError)
├── helper/                 # 核心中间件 (xHelper)
├── hook/                   # 钩子函数 (xHook)
├── http/                   # HTTP 常量 (xHttp)
├── log/                    # 日志系统 (xLog)
├── main/                   # 服务运行时 (xMain)
├── middleware/             # 业务中间件 (xMiddle)
├── models/                 # 数据模型基类 (xModels)
├── register/               # 应用注册和初始化 (xReg)
├── result/                 # 响应结果处理 (xResult)
├── route/                  # 路由处理 (xRoute)
├── snowflake/              # 雪花算法 ID 生成 (xSnowflake)
├── utility/                # 工具函数 (xUtil)
│   └── ctxutil/            # 上下文工具 (xCtxUtil)
└── validator/              # 验证器 (xVaild)
```

## 包导入别名

<TypeTable
  type={{
    'xBase': {
      description: '根包，统一响应结构体 BaseResponse',
      type: 'github.com/bamboo-services/bamboo-base-go',
      required: true,
    },
    'xConsts': {
      description: '上下文键常量定义',
      type: '.../context',
      required: true,
    },
    'xEnv': {
      description: '环境变量管理，类型安全的读取函数',
      type: '.../env',
      required: true,
    },
    'xError': {
      description: '错误码定义和错误处理',
      type: '.../error',
      required: true,
    },
    'xHelper': {
      description: '核心中间件（请求上下文、Panic 恢复、HTTP 日志）',
      type: '.../helper',
      required: true,
    },
    'xHook': {
      description: 'Redis 钩子，自动添加键前缀',
      type: '.../hook',
      required: true,
    },
    'xHttp': {
      description: 'HTTP 相关常量（请求头等）',
      type: '.../http',
      required: true,
    },
    'xLog': {
      description: '日志系统，支持彩色控制台和 JSON 文件输出',
      type: '.../log',
      required: true,
    },
    'xMiddle': {
      description: '业务中间件（CORS、响应处理等）',
      type: '.../middleware',
      required: true,
    },
    'xMain': {
      description: '服务运行时（统一启动、信号监听、优雅关闭）',
      type: '.../main',
      required: true,
    },
    'xModels': {
      description: 'GORM 实体基类，自动生成雪花 ID',
      type: '.../models',
      required: true,
    },
    'xReg': {
      description: '应用注册和初始化',
      type: '.../register',
      required: true,
    },
    'xResult': {
      description: '响应结果处理函数',
      type: '.../result',
      required: true,
    },
    'xRoute': {
      description: '路由处理（404、405）',
      type: '.../route',
      required: true,
    },
    'xSnowflake': {
      description: '雪花算法 ID 生成，支持业务基因',
      type: '.../snowflake',
      required: true,
    },
    'xUtil': {
      description: '通用工具函数',
      type: '.../utility',
      required: true,
    },
    'xCtxUtil': {
      description: '上下文工具函数',
      type: '.../utility/ctxutil',
      required: true,
    },
    'xVaild': {
      description: '验证器扩展，自定义规则和中文翻译',
      type: '.../validator',
      required: true,
    },
  }}
/>

## 模块依赖关系

<Mermaid
  chart="
graph TD
    xBase[xBase<br/>BaseResponse] --> xError[xError<br/>错误处理]

    xReg[xReg<br/>注册中心] --> xLog[xLog<br/>日志系统]
    xReg --> xSnowflake[xSnowflake<br/>雪花算法]
    xReg --> xHelper[xHelper<br/>核心中间件]
    xReg --> xVaild[xVaild<br/>验证器]

    xResult[xResult<br/>响应处理] --> xBase
    xResult --> xError
    xResult --> xLog

    xModels[xModels<br/>数据模型] --> xSnowflake

    xCtxUtil[xCtxUtil<br/>上下文工具] --> xConsts[xConsts<br/>上下文常量]
    xCtxUtil --> xSnowflake"
/>

## 初始化流程

<Mermaid
  chart="
flowchart TD
    A[Register] --> B[ConfigInit<br/>加载 .env 配置]
    B --> C[LoggerInit<br/>初始化日志系统]
    C --> D[SnowflakeInit<br/>初始化雪花算法节点]
    D --> E[EngineInit<br/>创建 Gin 引擎]
    E --> F[injectContext<br/>合并初始化上下文]
    F --> G[返回 *Reg]"
/>

```go title="main.go"
package main

import (
    "context"

    xReg "github.com/bamboo-services/bamboo-base-go/register"
)

func main() {
    // [!code highlight:2]
    // 一键初始化所有组件
    reg := xReg.Register(context.Background(), nil)

    // 注册路由...

    // [!code highlight]
    reg.Serve.Run(":8080")
}
```

## 核心依赖

| 依赖 | 版本 | 用途 |
|------|------|------|
| `gin-gonic/gin` | v1.10+ | Web 框架 |
| `go-playground/validator` | v10.30+ | 验证器 |
| `joho/godotenv` | v1.5+ | 环境变量加载 |
| `redis/go-redis` | v9.14+ | Redis 客户端 |
| `gorm.io/gorm` | v1.30+ | ORM 框架 |

## 设计原则

1. **单一职责** - 每个包只负责特定的功能领域
2. **统一命名** - 所有包使用 `x` 前缀别名，便于识别
3. **约定优于配置** - 提供合理的默认值，减少配置负担
4. **链路追踪** - 请求 ID 贯穿整个请求生命周期

## 下一步

<Cards>
  <Card title="快速开始" href="./core/init" />
  <Card title="响应处理" href="./core/result/result" />
</Cards>
