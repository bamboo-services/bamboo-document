---
title: 概述
description: xVaild 提供自定义验证器、中文翻译、错误响应处理
icon: ShieldCheck
---

import { TypeTable } from '@/components/type-table';

# 验证器

`xVaild` 基于 `go-playground/validator` 提供自定义验证器、中文翻译支持和统一错误响应处理。

```go
import xVaild "github.com/bamboo-services/bamboo-base-go/validator"
```

## 核心功能

<TypeTable
  type={{
    RegisterCustomValidators: {
      description: '注册所有自定义验证器',
      type: 'func(*validator.Validate) error',
      required: true,
    },
    RegisterTranslator: {
      description: '注册中文翻译器',
      type: 'func(*validator.Validate) error',
      required: true,
    },
    HandleValidationError: {
      description: '处理验证错误并返回响应',
      type: 'func(*gin.Context, error)',
      required: true,
    },
  }}
/>

## 自定义验证器

<TypeTable
  type={{
    strict_url: {
      description: '严格的 URL 验证（仅 HTTP/HTTPS）',
      type: 'string',
      required: true,
    },
    strict_uuid: {
      description: '严格的 UUID 格式验证',
      type: 'string',
      required: true,
    },
    alphanum_underscore: {
      description: '字母数字下划线验证',
      type: 'string',
      required: true,
    },
    regexp: {
      description: '正则表达式验证',
      type: 'string',
      required: true,
    },
    enum_int: {
      description: '整数枚举值验证',
      type: 'int',
      required: true,
    },
    enum_string: {
      description: '字符串枚举值验证',
      type: 'string',
      required: true,
    },
    enum_float: {
      description: '浮点数枚举值验证',
      type: 'float64',
      required: true,
    },
  }}
/>

## 快速使用

### 初始化验证器

```go title="register_engine.go"
func (r *Reg) EngineInit() {
    engine := gin.Default()

    // [!code highlight:2]
    // 获取 Gin 的验证器
    if v, ok := binding.Validator.Engine().(*validator.Validate); ok {
        // [!code highlight:2]
        // 注册自定义验证器
        _ = xVaild.RegisterCustomValidators(v)
        // [!code highlight:2]
        // 注册中文翻译器
        _ = xVaild.RegisterTranslator(v)
    }
}
```

### 定义请求结构

```go title="dto/user.go"
type CreateUserRequest struct {
    // [!code highlight:2]
    // 使用 label 标签定义中文字段名
    Username string `json:"username" label:"用户名" binding:"required,min=4,max=20,alphanum_underscore"`
    Password string `json:"password" label:"密码" binding:"required,min=8"`
    Email    string `json:"email" label:"邮箱" binding:"required,email"`
    // [!code highlight:2]
    // 使用枚举验证
    Role     string `json:"role" label:"角色" binding:"required,enum_string=admin user guest"`
    // [!code highlight:2]
    // 使用正则验证
    Phone    string `json:"phone" label:"手机号" binding:"required,regexp=^1[3-9]\\d{9}$"`
}
```

### 处理验证错误

```go title="handler/user.go"
func CreateUser(ctx *gin.Context) {
    var req dto.CreateUserRequest
    if err := ctx.ShouldBindJSON(&req); err != nil {
        // [!code highlight:2]
        // 自动处理验证错误并返回中文响应
        xVaild.HandleValidationError(ctx, err)
        return
    }
    // 业务逻辑...
}
```

## 错误响应格式

```json
{
  "context": "abc123",
  "output": "REQUEST_BODY_ERROR",
  "code": 40014,
  "message": "请求体错误",
  "error_message": "用户名格式不正确",
  "data": [
    {
      "field": "username",
      "tag": "alphanum_underscore",
      "message": "用户名只能包含字母、数字和下划线",
      "value": "user@name"
    }
  ]
}
```

## 下一步

<Cards>
  <Card title="自定义验证器" href="/docs/bamboo-base-go/components/validator/custom" />
  <Card title="中文翻译" href="/docs/bamboo-base-go/components/validator/translator" />
  <Card title="错误响应" href="/docs/bamboo-base-go/components/validator/response" />
</Cards>
